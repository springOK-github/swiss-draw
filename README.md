# ガンスリンガー方式バトル マッチングシステム

ガンスリンガー方式マッチングを管理するためのシステムです。主にポケモンカードバトル大会を対象としています。Google Apps Script (GAS) とスプレッドシートで動作します。

## 機能一覧

- プレイヤー管理
  - プレイヤー登録処理
  - プレイヤー休憩・復帰処理
  - プレイヤードロップアウト処理
- 自動マッチング（再戦回避機能付き）
  - 勝者優先マッチング（勝数が多い順、同勝数なら先着順）
  - 過去対戦相手の自動記録と再戦回避
  - 卓番号の自動管理と再利用
- 対戦結果記録
  - 勝敗統計の自動更新（勝数・敗数・消化試合数）
  - 対戦履歴の記録

## プレイヤーの状態遷移

1. 待機: マッチング待ち
2. 対戦中: 対戦進行中
3. 休憩: 一時的に対戦から離脱（復帰可能）
4. 終了: ドロップアウト済み（復帰不可）

## 主な特徴

### 再戦回避システム
- 過去に対戦した相手との再戦を自動的に回避
- 全員が過去対戦者の場合はマッチングを成立させず待機継続

### 勝者優先マッチング
- 勝数が多いプレイヤーを優先的にマッチング
- 同じ勝数の場合は先着順（最終対戦日時が古い順）を優先

### 卓番号管理
- 対戦終了後も卓番号を保持し、勝者が同じ卓を再利用
- 最大卓数は1～200の範囲で動的に設定可能（デフォルト: 50卓）
- カスタムメニューから現在の設定卓数を確認・変更可能
- 物理的な卓配置と連動した運用が可能

### 自動統計管理
- 勝数・敗数・消化試合数を自動集計
- 対戦履歴の完全な記録
- 最終対戦日時の自動更新

## セットアップ方法

### 1. スプレッドシートの準備
1. [Google スプレッドシート](https://sheets.google.com/)を新規作成
2. 「拡張機能」→「Apps Script」を開く
3. 本リポジトリの各 `.js` ファイルをスクリプトエディタにコピー
4. スクリプトを保存してスプレッドシートに戻る
5. ページを更新すると「🃏 ポケモンマッチング」メニューが表示される

### 2. 初期設定
1. カスタムメニューから「⚙️ シートの初期設定」を実行
2. 3つのシート（プレイヤー、対戦履歴、マッチング）が自動作成される

### 3. 大会運用の開始
1. カスタムメニューから「➕ プレイヤーを追加する」でプレイヤーを登録
2. 待機プレイヤーが2人以上になると自動でマッチング開始
3. 対戦終了後「✅ 対戦結果の記録」で勝者を記録
4. 必要に応じて休憩・復帰・ドロップアウト処理を実行

## 使用方法

### カスタムメニュー操作

- **➕ プレイヤーを追加する**: 新しいプレイヤーを追加（自動ID採番）
- **✅ 対戦結果の記録**: 勝者を指定して対戦を終了（統計自動更新）
- **☕ プレイヤーを休憩にする**: 一時的に対戦から離脱（後で復帰可能）
- **↩️ 休憩から復帰させる**: 休憩中のプレイヤーを待機状態に戻す（自動マッチング発動）
- **❌ プレイヤーをドロップアウトさせる**: 大会から完全に退出（復帰不可）
- **🔧 対戦結果の修正**: 誤って記録した対戦結果を修正
- **⚙️ 最大卓数の設定**: 使用する卓の最大数を設定（1～200、デフォルト: 50）

### データシート構成

システムは以下の3つのシートを使用します：

1. **プレイヤーシート**: プレイヤーマスタ
   - プレイヤーID、名前、勝敗数、消化試合数、参加状況、最終対戦日時

2. **対戦履歴シート**: 完了した対戦の記録
   - 日時、卓番号、両プレイヤーID・名前、勝者名、対戦ID

3. **マッチングシート**: 現在進行中の対戦
   - 卓番号、両プレイヤーID・名前

## よくある質問

### Q. 最大何人まで管理できますか？
A. プレイヤー数に制限はありませんが、50人以上での運用を想定した最適化を行っています。

### Q. 卓数の上限は変更できますか？
A. カスタムメニューの「⚙️ 最大卓数の設定」から1～200の範囲で設定可能です（デフォルト: 50卓）。

### Q. 対戦結果を間違えて記録してしまいました
A. カスタムメニューの「🔧 対戦結果の修正」から修正できます。対戦IDを指定して新しい勝者を入力してください。

### Q. プレイヤーが一時的に離席する場合は？
A. 「☕ プレイヤーを休憩にする」を使用してください。復帰時は「↩️ 休憩から復帰させる」で待機状態に戻ります。

### Q. 開発に参加したいのですが
A. [.github/copilot-instructions.md](.github/copilot-instructions.md) に開発者向けの詳細情報があります。Pull Requestも歓迎します！

## 作者

springOK

## ライセンス

MIT License

Copyright (c) 2025 springOK

このソフトウェアはMITライセンスの下で公開されています。
詳細は [LICENSE](LICENSE) ファイルを参照してください。
